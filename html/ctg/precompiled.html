
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>

<!--
	Copyright (c) 2001-2006 by Digital Mars
	All Rights Reserved
	www.digitalmars.com
  -->

<head>
<META http-equiv="content-type" content="text/html; charset=utf-8" >
<title>Digital Mars - Precompiled Headers
</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
<div id="heading">
<a href="http://www.digitalmars.com/"><IMG SRC="dmlogo.gif" BORDER=0 WIDTH=270 HEIGHT=53 ALT="www.digitalmars.com"></a>

<a href="http://www.digitalmars.com/" title="www.digitalmars.com">Home</a>
| <a href="../advancedsearch.html" title="Search Digital Mars web site">Search</a>
| <a href="ctg.html" title="Compiler & Tools Guide">CTG</a>
| <a href="../rtl/rtl.html" title="Runtime Library Reference">RTL</a>
| <a href="../ugr/ugr.html" title="IDDE Reference">IDDE</a>
| <a href="../stl/index.html" title="Standard Template Library">STL</a>

	<div id="lastupdate">Last update Fri Apr 28 16:25:45 2006
</div>
</div>

<!-- Generated by Ddoc from precompiled.d -->



<table border=1 cellpadding=8 cellspacing=0 frame="void" summary="this table is for layout only">
<tr>
<td valign="top" class="toc" nowrap>
<small>
<center>
<form method="get" action="http://www.google.com/search">
<input id="q" name="q" size="10" value="Search" onFocus='if(this.value == "Search"){this.value="";}'>
<input type="hidden" id="domains" name="domains" value="www.digitalmars.com">
<input type="hidden" id="sitesearch" name="sitesearch" value="www.digitalmars.com/ctg">
<input type="hidden" id="sourceid" name="sourceid" value="google-search">
<input type="submit" id="submit" name="submit" value="Go">
</form>
</center>

    <a href="ctg.html"><b>Compiler & Tools Guide</b></a><br>

<hr><b>Compiling</b><br>

    &#149; <a href="ctgCompilingCode.html">Compiling Code</a><br>
    &#149; <a href="C-Language-Implementation.html">C Implementation</a><br>
    &#149; <a href="CPP-Language-Implementation.html">C++ Implementation</a><br>
    &#149; <a href="ctgLanguageImplementation.html">Language Extensions</a><br>
    &#149; <a href="ctgMixingLanguages.html">Mixing Languages</a><br>
    &#149; <a href="ctgAsm.html">Assembly Language</a><br>
    &#149; <a href="ctgInlineAsm.html">Inline Assembler</a><br>
    &#149; <a href="ctgOptimizer.html">Optimizing Code</a><br>
    &#149; <a href="ctgNumerics.html">Numerics Programming</a><br>
    &#149; <a href="regular.html">Regular Expressions</a><br>
    &#149; <a href="acrtused.html">Acrtused</a><br>
    &#149; <a href="pragmas.html">Pragmas</a><br>
    &#149; <a href="precompiled.html">Precompiled Headers</a><br>
    &#149; <a href="predefined.html">Predefined Macros</a><br>
    &#149; <a href="warnings.html">Warning Messages</a><br>
    &#149; <a href="ctgCompilerErrors.html">Error Messages</a><br>
    &#149; <a href="warnings.html#runtime">Runtime Messages</a><br>
    <br>

<hr><b>Linking</b><br>

    &#149; <a href="optlink.html">Optlink</a><br>
    &#149; <a href="ctgLinkSwitches.html">Switches</a><br>
    &#149; <a href="ctgDefFiles.html">Module Definition Files</a><br>
    &#149; <a href="ctgLinkOps.html">Operation and Design</a><br>
    &#149; <a href="OptlinkErrorMessages.html">Error Messages</a><br>
    <br>

<hr><b>Win32 Programming</b><br>

    &#149; <a href="win32programming.html#win32">Win32 Programming</a><br>
    <br>

<hr><b>DOS and Win16<br>Programming</b><br>

    &#149; <a href="ctgMemoryModel.html">Memory Models</a><br>
    &#149; <a href="pointers16.html">16 Bit Pointer Types<br> and Type Modifiers</a><br>
    &#149; <a href="win32programming.html#handle">Handle Pointers</a><br>
    &#149; <a href="win32programming.html#dos">DOS</a><br>
    &#149; <a href="dos32.html">DOS 32 (DOSX)</a><br>
    &#149; <a href="win32programming.html#win16">Win16</a><br>
    &#149; <a href="win32programming.html#win16dll">Win16 DLLs</a><br>
    &#149; <a href="windowspe.html">Win16 Prolog/Epilog</a><br>
    <br>

<hr><b>C/C++ Extensions</b><br>

    &#149; <a href="contract.html">Contract Programming</a><br>
    &#149; <a href="debugstatement.html">__debug statement</a><br>
    &#149; <a href="debugstatement.html#debugdeclaration">__debug declaration</a><br>
    &#149; <a href="trace.html">Dynamic Profiling</a><br>
    &#149; <a href="html.html">Embedding C in HTML</a><br>
    <br>

<hr><b>Tools</b><br>

    &#149; <a href="bcc.html" title="Convert Borland compiler commands">BCC</a><br>
    &#149; <a href="chmod.html" title="Examine and change file attributes">CHMOD</a><br>
    &#149; <a href="cl.html" title="Convert Microsoft compiler commands">CL</a><br>
    &#149; <a href="coff2omf.html" title="Convert COFF .obj and .lib to OMF">COFF2OMF</a><br>
    &#149; <a href="coffimplib.html" title="Convert COFF import library OMF">COFFIMPLIB</a><br>
    &#149; <a href="sc.html" title="Compiler command">DMC</a><br>
    &#149; <a href="diff.html" title="Compare files">DIFF</a><br>
    &#149; <a href="diffdir.html" title="Compare directories">DIFFDIR</a><br>
    &#149; <a href="dump.html" title="Dump files in hex">DUMP</a><br>
    &#149; <a href="dumpobj.html" title="Dump object files in hex">DUMPOBJ</a><br>
    &#149; <a href="dumpexe.html" title="Dump exe files">DUMPEXE</a><br>
    &#149; <a href="exe2bin.html" title="Create .com files">EXE2BIN</a><br>
    &#149; <a href="flpyimg.html" title="Read/Write Floppy Image">FLPYIMG</a><br>
    &#149; <a href="grep.html" title="Search files for string">GREP</a><br>
    &#149; <a href="ctgHelp.html" title="Creating Help Tools">HC</a><br>
    &#149; <a href="implib.html" title="Build import libraries">IMPLIB</a><br>
    &#149; <a href="lib.html" title="Object file librarian">LIB</a><br>
    &#149; <a href="libunres.html" title="Analyze library and object files">LIBUNRES</a><br>
    &#149; <a href="make.html" title="Simple make utility">MAKE</a><br>
    &#149; <a href="makedep.html" title="Update makefile dependencies">MAKEDEP</a><br>
    &#149; <a href="me.html" title="MicroEmacs Text Editor">ME</a><br>
    &#149; <a href="obj2asm.html" title="Object file disassembler">OBJ2ASM</a><br>
    &#149; <a href="patchobj.html" title="Patch object files">PATCHOBJ</a><br>
    &#149; <a href="ctgRC.html" title="Microsoft Resource compiler">RC</a><br>
    &#149; <a href="rcc.html" title="Digital Mars Resource compiler">RCC</a><br>
    &#149; <a href="sc.html" title="Compiler command">SC</a><br>
    &#149; <a href="shell.html" title="Shell scripts">SHELL</a><br>
    &#149; <a href="smake.html" title="Manage complex projects">SMAKE</a><br>
    &#149; <a href="touch.html" title="Set file timestamps">TOUCH</a><br>
    &#149; <a href="unmangle.html" title="Format C++ mangled names">UNMANGLE</a><br>
    &#149; <a href="whereis.html" title="Search for files">WHEREIS</a><br>
    <br>

<hr><b>Porting to DMC++</b><br>

    &#149; <a href="switchtodigitalmars.html">Switching to DMC++</a><br>
    &#149; <a href="switchtodigitalmars.html#microsoft">from Microsoft</a><br>
    &#149; <a href="switchtodigitalmars.html#borland">from Borland</a><br>
    &#149; <a href="ctgPorting.html">Porting Guide</a><br>
    <br>

</small>

<hr>

</td>
<td valign="top">


<h1>Precompiled Headers</h1>

If your program uses a large header file or numerous small headers, 
the compiler spends considerable time compiling the same code 
over and over again. To save compile time, precompile a 
header file; the compiler can load a precompiled header faster than 
it can a text header file. The compiler includes a precompiled 
header only once in a file, regardless of how many #include 
statements for it appear. 


<h3>How the compiler precompiles a header</h3>

A precompiled header consists of the header file's global symbol table
and any macros defined by the header.
A header intended for precompilation should, 
therefore, contain only declarations and no definitions. 
<p>

For example, the following declarations are appropriate for use in 
precompiled headers: 

<pre>
	extern int abc;
	int foo(int x); 
	inline void g(x) { foo(x); } // inline function definition 
	#define MACRO(x) asdf(x) 
</pre>

These will not work: 

<pre>
	int def = 3; // a definition
	void g(x) { foo(x); } // function definition 
</pre>

<h3>Precompiled header options</h3>

These switches to <a href="sc.html">SC</a> control precompiled headers.
Corresponding IDDE options are in the 
Header Files subpage on the Build page of the IDDE's Project 
Settings dialog box. 

<ul>
	<li><a href="sc.html#dashCapH"><b>-H</b></a>
		Use precompiled headers
 	<li><a href="sc.html#dashCapHCapC"><b>-HC</b></a>
		Do not cache precompiled headers in memory
	<li><a href="sc.html#dashCapHCapD"><b>-HD</b><i>directory</i></a>
		Read/write precompiled headers in <i>directory</i>
	<li><a href="sc.html#dashCapHCapF"><b>-HF</b>[<i>filename</i>[<b>.sym</b>]]</a>
		Write precompiled header to <i>filename</i><b>.sym</b>
	<li><a href="sc.html#dashCapHCapI"><b>-HI</b></a>
		Include header file
	<li><a href="sc.html#dashCapHCapM"><b>-HM</b><i>address</i></a>
		Set address for memory mapped files precompiled header files
	<li><a href="sc.html#dashCapHCapO"><b>-HO</b></a>
		Include header files only once
	<li><a href="sc.html#dashCapHCapS"><b>-HS</b></a>
		Search for include files only in <b>-I</b><i>path</i>
		directories
	<li><a href="sc.html#dashCapHCapX"><b>-HX</b></a>
		Use automatic precompiled headers
	<li><a href="sc.html#dashCapI"><b>-I</b><i>path</i></a>
		Set search path for include files
</ul>


To use a precompiled header:

<ul>
	<li> Create a directory for the program files. 
	<li> #include the header file in each source file.
	<li> Edit the program's makefile. 
</ul>

Create a directory specifically for the program that 
includes its source files and makefile. When compiling,
this directory is the current directory, and the compiler 
automatically writes the precompiled headers there. A program 
should have its own directory because precompiled headers are 
highly specialized, and it is unlikely that a precompiled header for 
one program can work with another. 
<p>

#include the precompiled header in the source as you 
normally would. For example, to use a precompiled version of 
stdio.h in a program, write: 

<pre>
	#include &lt;stdio.h&gt; 
	main()
	{ 
	    printf("hello world\n");
	} 
</pre>


The program's <tt>makefile</tt> must precompile the header file and include 
the precompiled header in the list of dependencies for all the source 
files that #include it. For example, this is the makefile for the 
hello world program:

<pre>
	stdio.sym : stdio.h makefile
		sc -HF stdio.h 

	hello.exe : hello.c stdio.sym
		sc -H hello 
</pre>

The first two lines are for the precompiled header. The name of the 
precompiled header is the same as the text header, except it ends in 
 .sym instead of .h. The <tt>sc -HF</tt> command precompiles the header 
file, creates a .sym file and places it in the current directory. The 
precompiled header depends not only on the text header file, but 
also on the program's makefile. This is because changes in the 
makefile, such as using a different memory model or target CPU, 
change how the compiler precompiles the header. 
<p>


The last two lines above are for the program's source file. The 
executable file is dependent not only on its source file, but also on 
the precompiled header. The -H option tells the compiler that when 
it looks for a header file, it should first look in the current directory 
for .sym files. 


<h3>Using a project precompiled header</h3>

	If many source files #include the same files, you might 
	want to create a project precompiled header that #includes 
	several text header files. 
	<p>


	For example, if the files in the project all #include stdio.h, 
	string.h and myglobals.h, create a project header 
	file project.h that contains just these lines: 

<pre>
	#include &lt;stdio.h&gt;
	#include &lt;string.h&gt; 
	#include "myglobals.h" 
</pre>

	Precompile project.h with this command: 

<pre>
	sc -HF project.h 
</pre>

	Then compile them with the -H and -HI options: 

<pre>
	sc file1 file2 file3 -HIproject.h -H 
</pre>

<h3>"Automatic" Precompiled Headers (-HX)</h3>

	Using -HX improves compile times for 
	most programs. Instances where this might not be the case include: 

<ul>
	<li> When the file being compiled causes scph.sym to be 
	regenerated but that contains a subset of the #include 
	files as do other files in the program. 

	<li> When #include files are nested in #if or extern "C" 
	{   } blocks. Fix by putting the extern "C" 
	statements in the #include files themselves. 
</ul>


<h3>Using a fast disk with a precompiled header</h3>
 
	To make a precompiled header file even faster,
	place it on the fastest disk drive in your system.
	To let the compiler know where the 
	precompiled file is, make some changes in the 
	makefile. First, precompile the header file with -HF to 
	specify where to place it. Then, use -HD to set the path
	to read the precompiled header.
	<p>

	For example, if the fastest disk is drive e, the makefile for the hello 
	world program would be: 


<pre>
	TMP=e: 

	stdio.sym : stdio.h makefile
		sc -HF stdio stdio.h 

	hello.exe : hello.c stdio.sym
		sc -HD hello 
</pre>
	or, with automatic precompiled headers:

<pre>
	TMP=e: 

	hello.exe : hello.c
		sc -HD -HX hello 
</pre>

<h2>Tips For Precompiled Headers</h2>

To make the best use of precompiled headers, follow these rules: 

<ol>
	<li> Header files should contain complete definitions, i.e. starting a
	declaration in one file and finishing it in another should be avoided.
	Every header file should be self-contained.

	<li> Design headers so they only need to be #include'd once.
	Then, wrap the header in:

	<pre>
	#ifndef _HEADER_H
	#define _HEADER_H 1
		... declarations ...
	#endif // _HEADER_H
	</pre>

	so that if it is #include'd multiple times, it is parsed only once. 
	In addition, add:

	<pre>
	#pragma once
	</pre>

	to it so the compiler doesn't need to rescan it.

	<li> Design headers so they can be #include'd in any order.
	The best way to do
	this is to have each header #include the ones it depends on.
	By following
	rule (2), this will not have a compile time penalty.

	<li> Avoid defining data in the headers.

	<li> Avoid putting executable code, other than inline
	functions, in headers.

	<li> Avoid #undef'ing macros and redefining them to something else.

	<li> If the struct packing is set to something other than the default,
	set it back to the default before the end of the file.

	<li> Do not write extern "C" constructs that start in one file 
	and end in another. 

	<li> If the header file has changed since the last time 
	you precompiled it, the compiler uses the older 
	precompiled header file. Updating the precompiled header
	file should be done by the makefile.

	<li> #include directives for precompiled header file(s) 
	should be the first line(s) in a source file other than 
	comments. If other code precedes the #include 
	directive for a precompiled header,
	ensure that the code does not affect compilation of 
	the header file. 

</ol>


<br><br><br><br>

</td></table>





<div id="copyright">
Copyright &copy; 1999-2006 by Digital Mars, All Rights Reserved |
Page generated by <a href="http://www.digitalmars.com/d/ddoc.html">Ddoc</a>.
</div>

</body>
</html>

