
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>

<!--
	Copyright (c) 2001-2006 by Digital Mars
	All Rights Reserved
	www.digitalmars.com
  -->

<head>
<META http-equiv="content-type" content="text/html; charset=utf-8" >
<title>Digital Mars - Contract Programming
</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
<div id="heading">
<a href="http://www.digitalmars.com/"><IMG SRC="dmlogo.gif" BORDER=0 WIDTH=270 HEIGHT=53 ALT="www.digitalmars.com"></a>

<a href="http://www.digitalmars.com/" title="www.digitalmars.com">Home</a>
| <a href="../advancedsearch.html" title="Search Digital Mars web site">Search</a>
| <a href="ctg.html" title="Compiler & Tools Guide">CTG</a>
| <a href="../rtl/rtl.html" title="Runtime Library Reference">RTL</a>
| <a href="../ugr/ugr.html" title="IDDE Reference">IDDE</a>
| <a href="../stl/index.html" title="Standard Template Library">STL</a>

	<div id="lastupdate">Last update Fri Apr 28 16:25:46 2006
</div>
</div>

<!-- Generated by Ddoc from contract.d -->




<table border=1 cellpadding=8 cellspacing=0 frame="void" summary="this table is for layout only">
<tr>
<td valign="top" class="toc" nowrap>
<small>
<center>
<form method="get" action="http://www.google.com/search">
<input id="q" name="q" size="10" value="Search" onFocus='if(this.value == "Search"){this.value="";}'>
<input type="hidden" id="domains" name="domains" value="www.digitalmars.com">
<input type="hidden" id="sitesearch" name="sitesearch" value="www.digitalmars.com/ctg">
<input type="hidden" id="sourceid" name="sourceid" value="google-search">
<input type="submit" id="submit" name="submit" value="Go">
</form>
</center>

    <a href="ctg.html"><b>Compiler & Tools Guide</b></a><br>

<hr><b>Compiling</b><br>

    &#149; <a href="ctgCompilingCode.html">Compiling Code</a><br>
    &#149; <a href="C-Language-Implementation.html">C Implementation</a><br>
    &#149; <a href="CPP-Language-Implementation.html">C++ Implementation</a><br>
    &#149; <a href="ctgLanguageImplementation.html">Language Extensions</a><br>
    &#149; <a href="ctgMixingLanguages.html">Mixing Languages</a><br>
    &#149; <a href="ctgAsm.html">Assembly Language</a><br>
    &#149; <a href="ctgInlineAsm.html">Inline Assembler</a><br>
    &#149; <a href="ctgOptimizer.html">Optimizing Code</a><br>
    &#149; <a href="ctgNumerics.html">Numerics Programming</a><br>
    &#149; <a href="regular.html">Regular Expressions</a><br>
    &#149; <a href="acrtused.html">Acrtused</a><br>
    &#149; <a href="pragmas.html">Pragmas</a><br>
    &#149; <a href="precompiled.html">Precompiled Headers</a><br>
    &#149; <a href="predefined.html">Predefined Macros</a><br>
    &#149; <a href="warnings.html">Warning Messages</a><br>
    &#149; <a href="ctgCompilerErrors.html">Error Messages</a><br>
    &#149; <a href="warnings.html#runtime">Runtime Messages</a><br>
    <br>

<hr><b>Linking</b><br>

    &#149; <a href="optlink.html">Optlink</a><br>
    &#149; <a href="ctgLinkSwitches.html">Switches</a><br>
    &#149; <a href="ctgDefFiles.html">Module Definition Files</a><br>
    &#149; <a href="ctgLinkOps.html">Operation and Design</a><br>
    &#149; <a href="OptlinkErrorMessages.html">Error Messages</a><br>
    <br>

<hr><b>Win32 Programming</b><br>

    &#149; <a href="win32programming.html#win32">Win32 Programming</a><br>
    <br>

<hr><b>DOS and Win16<br>Programming</b><br>

    &#149; <a href="ctgMemoryModel.html">Memory Models</a><br>
    &#149; <a href="pointers16.html">16 Bit Pointer Types<br> and Type Modifiers</a><br>
    &#149; <a href="win32programming.html#handle">Handle Pointers</a><br>
    &#149; <a href="win32programming.html#dos">DOS</a><br>
    &#149; <a href="dos32.html">DOS 32 (DOSX)</a><br>
    &#149; <a href="win32programming.html#win16">Win16</a><br>
    &#149; <a href="win32programming.html#win16dll">Win16 DLLs</a><br>
    &#149; <a href="windowspe.html">Win16 Prolog/Epilog</a><br>
    <br>

<hr><b>C/C++ Extensions</b><br>

    &#149; <a href="contract.html">Contract Programming</a><br>
    &#149; <a href="debugstatement.html">__debug statement</a><br>
    &#149; <a href="debugstatement.html#debugdeclaration">__debug declaration</a><br>
    &#149; <a href="trace.html">Dynamic Profiling</a><br>
    &#149; <a href="html.html">Embedding C in HTML</a><br>
    <br>

<hr><b>Tools</b><br>

    &#149; <a href="bcc.html" title="Convert Borland compiler commands">BCC</a><br>
    &#149; <a href="chmod.html" title="Examine and change file attributes">CHMOD</a><br>
    &#149; <a href="cl.html" title="Convert Microsoft compiler commands">CL</a><br>
    &#149; <a href="coff2omf.html" title="Convert COFF .obj and .lib to OMF">COFF2OMF</a><br>
    &#149; <a href="coffimplib.html" title="Convert COFF import library OMF">COFFIMPLIB</a><br>
    &#149; <a href="sc.html" title="Compiler command">DMC</a><br>
    &#149; <a href="diff.html" title="Compare files">DIFF</a><br>
    &#149; <a href="diffdir.html" title="Compare directories">DIFFDIR</a><br>
    &#149; <a href="dump.html" title="Dump files in hex">DUMP</a><br>
    &#149; <a href="dumpobj.html" title="Dump object files in hex">DUMPOBJ</a><br>
    &#149; <a href="dumpexe.html" title="Dump exe files">DUMPEXE</a><br>
    &#149; <a href="exe2bin.html" title="Create .com files">EXE2BIN</a><br>
    &#149; <a href="flpyimg.html" title="Read/Write Floppy Image">FLPYIMG</a><br>
    &#149; <a href="grep.html" title="Search files for string">GREP</a><br>
    &#149; <a href="ctgHelp.html" title="Creating Help Tools">HC</a><br>
    &#149; <a href="implib.html" title="Build import libraries">IMPLIB</a><br>
    &#149; <a href="lib.html" title="Object file librarian">LIB</a><br>
    &#149; <a href="libunres.html" title="Analyze library and object files">LIBUNRES</a><br>
    &#149; <a href="make.html" title="Simple make utility">MAKE</a><br>
    &#149; <a href="makedep.html" title="Update makefile dependencies">MAKEDEP</a><br>
    &#149; <a href="me.html" title="MicroEmacs Text Editor">ME</a><br>
    &#149; <a href="obj2asm.html" title="Object file disassembler">OBJ2ASM</a><br>
    &#149; <a href="patchobj.html" title="Patch object files">PATCHOBJ</a><br>
    &#149; <a href="ctgRC.html" title="Microsoft Resource compiler">RC</a><br>
    &#149; <a href="rcc.html" title="Digital Mars Resource compiler">RCC</a><br>
    &#149; <a href="sc.html" title="Compiler command">SC</a><br>
    &#149; <a href="shell.html" title="Shell scripts">SHELL</a><br>
    &#149; <a href="smake.html" title="Manage complex projects">SMAKE</a><br>
    &#149; <a href="touch.html" title="Set file timestamps">TOUCH</a><br>
    &#149; <a href="unmangle.html" title="Format C++ mangled names">UNMANGLE</a><br>
    &#149; <a href="whereis.html" title="Search for files">WHEREIS</a><br>
    <br>

<hr><b>Porting to DMC++</b><br>

    &#149; <a href="switchtodigitalmars.html">Switching to DMC++</a><br>
    &#149; <a href="switchtodigitalmars.html#microsoft">from Microsoft</a><br>
    &#149; <a href="switchtodigitalmars.html#borland">from Borland</a><br>
    &#149; <a href="ctgPorting.html">Porting Guide</a><br>
    <br>

</small>

<hr>

</td>
<td valign="top">


<h1>Contract Programming</h1>

	Contracts are a breakthrough technique to reduce the programming effort
	for large projects. Contracts are the concept of preconditions, postconditions,
	errors, and invariants.
	Digital Mars introduces the first C and C++ compiler to support contracts.
<p>
	Building contract support into the language makes for:
<ol>
	<li> a consistent look and feel for the contracts
	<li> tool support
	<li> it's possible the compiler can generate better code using information gathered
	from the contracts
	<li> easier management and enforcement of contracts
	<li> handling of contract inheritance
</ol>
	The idea of a contract is simple - it's just an expression that must evaluate to true.
	If it does not, the contract is broken, and by definition, the program has a bug in it.
	Contracts form part of the specification for a program, moving it from the documentation
	to the code itself. And as every programmer knows, documentation tends to be incomplete,
	out of date, wrong, or non-existent. Moving the contracts into the code makes them
	verifiable against the program.
<p>
	Contracts in Digital Mars C/C++ introduce the following new keywords:
<pre>
	    __in
	    __out
	    __body
	    __invariant		(for C++)
</pre>
	If contracts become adopted by the ANSI standards, the keywords will
	likely lose the __ prefix, so it is best to assume that in, out, body
	and invariant will become keywords.
<p>
	Contracts are enabled by throwing the -D compiler switch. If the -D
	switch is not thrown, the contract code is not generated or executed.
	Source files with contracts compiled with -D can be freely intermingled
	with source files with contracts not compiled with -D.
<p>
<h3>Assert Contract</h3>
<p>
	The most basic contract is the assert. An assert inserts a checkable expression into
	the code, and that expression must evaluate to true:
<pre>
	assert(expression);
</pre>
	C/C++ programmers will find this familiar - it's already in the
	language. The Digital Mars contract extensions use the assert as the
	fundamental building block of contracts.
<p>
<h3>Pre and Post Contracts</h3>
<p>
	The pre contracts specify the preconditions before a function
	body is executed.
	The most typical use of this would be in validating the parameters to a
	function. The post contracts validate the result of the function, which
	are its return value and any side effects.
	The syntax is:
<p>
<pre>
	function declaration(parameters)
	__in
	{
	    ...contract preconditions...
	}
	__out (result)
	{
	    ...contract postconditions...
	}
	__body
	{
	    ...code...
	}
</pre>
	By definition, if a pre contract fails, then the body
	received bad parameters.
	If a post contract fails,
	then there is a bug in the body.
<p>
	Either the <tt>__in</tt> or the <tt>__out</tt> clause can be omitted.
	If the <tt>out</tt> clause is for a function
	body, the variable <tt>result</tt> is declared and assigned the return
	value of the function.
	For example, let's implement a square root function:
<pre>
	long square_root(long x)
	    __in
	    {
		assert(x &gt; 0);
	    }
	    __out (result)
	    {
		assert((result * result) == x);
	    }
	    __body
	    {
		return sqrt(x);
	    }
</pre>
	The assert's in the in and out bodies are the specific <dfn>contracts</dfn>.
	Any other C/C++ statement or expression is allowed in the bodies,
	but it is important to make sure that such
	code has no side effects, so the release version of the code will
	not depend on any effects of the code.
	For a release build of the code, the __in and __out code is not
	inserted.
<p>
	If the function returns a void, there is no result, and so there can be no
	result declaration in the out clause.
	In that case, use:
<pre>
	void func()
	   __out
	   {
		...contracts...
	   }
	   __body
	   {
		...
	   }
</pre>
<h3>Class Invariants (C++ only)</h3>
<p>
	Class invariants are used to specify characteristics of a class that always
	must be true (except while executing a member function). For example, a
	class representing a date might have an invariant that the day must be 1..31
	and the hour must be 0..23:
<p>
<pre>
	struct Date
	{
	    int day;
	    int hour;

	    __invariant()
	    {
		assert(1 &lt;= day &amp;&amp; day &lt;= 31);
		assert(0 &lt;= hour &amp;&amp; hour &lt; 24);
	    }
	};
</pre>
<p>
	The class invariant is a contract saying that the asserts must hold true.
	The invariant is checked when a class constructor completes,
	at the start of the class destructor, before a public
	member is run, and after a public function finishes.
	Class invariants are inherited, that is,
	any class invariant is implicitly anded with the invariants of its base classes.
	Class invariant functions can be declared virtual, and as a general rule,
	they should be virtual if and only if the class destructor is virtual.
<p>
	When compiling for release, the invariant code is not generated, and the compiled program
	runs at maximum speed.
<p>
<h3>Future Directions with DBC</h3>

	These are some issues that will be addressed in the future with the
	DBC feature in DMC++. Anticipate these changes when writing contract
	code.
<p>
	If the function is virtual, the __in clause needs to be OR'd with
	the __in clauses of any functions it overrides in all the base
	classes. Similarly, the __out clause needs to be AND'd with all the
	__out clauses.
<p>
	__in clauses should not be able to modify the function parameters.
<p>
	When an __out clause references a function parameter, the value should
	be the same as when the function was called, and not what it is after
	the function body may have modified it.
<p>
	Currently, contracts rely on the assert() macro aborting the program
	with a message. Perhaps this needs to be revisited, and changed
	to throw an exception instead.

<h3>Legacy Compilers</h3>
<p>
	Contract code can be ported to legacy compilers by using #ifdef's:
<pre>
	void foo()
	#ifdef __DMC__
	    __in
	    {
		...
	    }
	    __body
	#endif
	    {
	    }
</pre>
<p>
<h3>References</h3>
<a href="http://www.digitalmars.com/d/dbc.html">DbC in the D Programming Language</a><br>
<a href="http://www.designbycontract.com/">Design by Contract portal</a><br>
<a href="http://www.elj.com/eiffel/dbc">Design By Contract: A Missing Link In The Quest For Quality Software</a><br>
<a href="http://www.cs.virginia.edu/~yel4j/cs655/final_report.html">Final Report</a><br>
<a href="http://pandonia.canberra.edu.au/java/contracts/paper-long.html">Adding Contracts to Java</a><br>


<br><br><br><br>

</td></table>






<div id="copyright">
Copyright &copy; 1999-2006 by Digital Mars, All Rights Reserved |
Page generated by <a href="http://www.digitalmars.com/d/ddoc.html">Ddoc</a>.
</div>

</body>
</html>

