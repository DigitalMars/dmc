
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>

<!--
	Copyright (c) 2001-2006 by Digital Mars
	All Rights Reserved
	www.digitalmars.com
  -->

<head>
<META http-equiv="content-type" content="text/html; charset=utf-8" >
<title>Digital Mars - Porting Guide
</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
<div id="heading">
<a href="http://www.digitalmars.com/"><IMG SRC="dmlogo.gif" BORDER=0 WIDTH=270 HEIGHT=53 ALT="www.digitalmars.com"></a>

<a href="http://www.digitalmars.com/" title="www.digitalmars.com">Home</a>
| <a href="../advancedsearch.html" title="Search Digital Mars web site">Search</a>
| <a href="ctg.html" title="Compiler & Tools Guide">CTG</a>
| <a href="../rtl/rtl.html" title="Runtime Library Reference">RTL</a>
| <a href="../ugr/ugr.html" title="IDDE Reference">IDDE</a>
| <a href="../stl/index.html" title="Standard Template Library">STL</a>

	<div id="lastupdate">Last update Fri Apr 28 16:25:47 2006
</div>
</div>

<!-- Generated by Ddoc from ctgPorting.d -->




<table border=1 cellpadding=8 cellspacing=0 frame="void" summary="this table is for layout only">
<tr>
<td valign="top" class="toc" nowrap>
<small>
<center>
<form method="get" action="http://www.google.com/search">
<input id="q" name="q" size="10" value="Search" onFocus='if(this.value == "Search"){this.value="";}'>
<input type="hidden" id="domains" name="domains" value="www.digitalmars.com">
<input type="hidden" id="sitesearch" name="sitesearch" value="www.digitalmars.com/ctg">
<input type="hidden" id="sourceid" name="sourceid" value="google-search">
<input type="submit" id="submit" name="submit" value="Go">
</form>
</center>

    <a href="ctg.html"><b>Compiler & Tools Guide</b></a><br>

<hr><b>Compiling</b><br>

    &#149; <a href="ctgCompilingCode.html">Compiling Code</a><br>
    &#149; <a href="C-Language-Implementation.html">C Implementation</a><br>
    &#149; <a href="CPP-Language-Implementation.html">C++ Implementation</a><br>
    &#149; <a href="ctgLanguageImplementation.html">Language Extensions</a><br>
    &#149; <a href="ctgMixingLanguages.html">Mixing Languages</a><br>
    &#149; <a href="ctgAsm.html">Assembly Language</a><br>
    &#149; <a href="ctgInlineAsm.html">Inline Assembler</a><br>
    &#149; <a href="ctgOptimizer.html">Optimizing Code</a><br>
    &#149; <a href="ctgNumerics.html">Numerics Programming</a><br>
    &#149; <a href="regular.html">Regular Expressions</a><br>
    &#149; <a href="acrtused.html">Acrtused</a><br>
    &#149; <a href="pragmas.html">Pragmas</a><br>
    &#149; <a href="precompiled.html">Precompiled Headers</a><br>
    &#149; <a href="predefined.html">Predefined Macros</a><br>
    &#149; <a href="warnings.html">Warning Messages</a><br>
    &#149; <a href="ctgCompilerErrors.html">Error Messages</a><br>
    &#149; <a href="warnings.html#runtime">Runtime Messages</a><br>
    <br>

<hr><b>Linking</b><br>

    &#149; <a href="optlink.html">Optlink</a><br>
    &#149; <a href="ctgLinkSwitches.html">Switches</a><br>
    &#149; <a href="ctgDefFiles.html">Module Definition Files</a><br>
    &#149; <a href="ctgLinkOps.html">Operation and Design</a><br>
    &#149; <a href="OptlinkErrorMessages.html">Error Messages</a><br>
    <br>

<hr><b>Win32 Programming</b><br>

    &#149; <a href="win32programming.html#win32">Win32 Programming</a><br>
    <br>

<hr><b>DOS and Win16<br>Programming</b><br>

    &#149; <a href="ctgMemoryModel.html">Memory Models</a><br>
    &#149; <a href="pointers16.html">16 Bit Pointer Types<br> and Type Modifiers</a><br>
    &#149; <a href="win32programming.html#handle">Handle Pointers</a><br>
    &#149; <a href="win32programming.html#dos">DOS</a><br>
    &#149; <a href="dos32.html">DOS 32 (DOSX)</a><br>
    &#149; <a href="win32programming.html#win16">Win16</a><br>
    &#149; <a href="win32programming.html#win16dll">Win16 DLLs</a><br>
    &#149; <a href="windowspe.html">Win16 Prolog/Epilog</a><br>
    <br>

<hr><b>C/C++ Extensions</b><br>

    &#149; <a href="contract.html">Contract Programming</a><br>
    &#149; <a href="debugstatement.html">__debug statement</a><br>
    &#149; <a href="debugstatement.html#debugdeclaration">__debug declaration</a><br>
    &#149; <a href="trace.html">Dynamic Profiling</a><br>
    &#149; <a href="html.html">Embedding C in HTML</a><br>
    <br>

<hr><b>Tools</b><br>

    &#149; <a href="bcc.html" title="Convert Borland compiler commands">BCC</a><br>
    &#149; <a href="chmod.html" title="Examine and change file attributes">CHMOD</a><br>
    &#149; <a href="cl.html" title="Convert Microsoft compiler commands">CL</a><br>
    &#149; <a href="coff2omf.html" title="Convert COFF .obj and .lib to OMF">COFF2OMF</a><br>
    &#149; <a href="coffimplib.html" title="Convert COFF import library OMF">COFFIMPLIB</a><br>
    &#149; <a href="sc.html" title="Compiler command">DMC</a><br>
    &#149; <a href="diff.html" title="Compare files">DIFF</a><br>
    &#149; <a href="diffdir.html" title="Compare directories">DIFFDIR</a><br>
    &#149; <a href="dump.html" title="Dump files in hex">DUMP</a><br>
    &#149; <a href="dumpobj.html" title="Dump object files in hex">DUMPOBJ</a><br>
    &#149; <a href="dumpexe.html" title="Dump exe files">DUMPEXE</a><br>
    &#149; <a href="exe2bin.html" title="Create .com files">EXE2BIN</a><br>
    &#149; <a href="flpyimg.html" title="Read/Write Floppy Image">FLPYIMG</a><br>
    &#149; <a href="grep.html" title="Search files for string">GREP</a><br>
    &#149; <a href="ctgHelp.html" title="Creating Help Tools">HC</a><br>
    &#149; <a href="implib.html" title="Build import libraries">IMPLIB</a><br>
    &#149; <a href="lib.html" title="Object file librarian">LIB</a><br>
    &#149; <a href="libunres.html" title="Analyze library and object files">LIBUNRES</a><br>
    &#149; <a href="make.html" title="Simple make utility">MAKE</a><br>
    &#149; <a href="makedep.html" title="Update makefile dependencies">MAKEDEP</a><br>
    &#149; <a href="me.html" title="MicroEmacs Text Editor">ME</a><br>
    &#149; <a href="obj2asm.html" title="Object file disassembler">OBJ2ASM</a><br>
    &#149; <a href="patchobj.html" title="Patch object files">PATCHOBJ</a><br>
    &#149; <a href="ctgRC.html" title="Microsoft Resource compiler">RC</a><br>
    &#149; <a href="rcc.html" title="Digital Mars Resource compiler">RCC</a><br>
    &#149; <a href="sc.html" title="Compiler command">SC</a><br>
    &#149; <a href="shell.html" title="Shell scripts">SHELL</a><br>
    &#149; <a href="smake.html" title="Manage complex projects">SMAKE</a><br>
    &#149; <a href="touch.html" title="Set file timestamps">TOUCH</a><br>
    &#149; <a href="unmangle.html" title="Format C++ mangled names">UNMANGLE</a><br>
    &#149; <a href="whereis.html" title="Search for files">WHEREIS</a><br>
    <br>

<hr><b>Porting to DMC++</b><br>

    &#149; <a href="switchtodigitalmars.html">Switching to DMC++</a><br>
    &#149; <a href="switchtodigitalmars.html#microsoft">from Microsoft</a><br>
    &#149; <a href="switchtodigitalmars.html#borland">from Borland</a><br>
    &#149; <a href="ctgPorting.html">Porting Guide</a><br>
    <br>

</small>

<hr>

</td>
<td valign="top">

<h1>Porting Guide</h1>
 
This chapter lists and describes compiler and/or linker errors and
other problems that can occur when porting existing code to Digital Mars C++. 

<h3>What's in This Chapter</h3>

<ul>
	<li> General porting issues. 
	<li> Porting issues pertaining to code written with Microsoft 
	Visual C++. 
	<li> Porting issues pertaining to code written with Borland 
	C++ Version 3. 
	<li> Porting issues pertaining to older Zortech C++ code, or 
	code written with previous versions of Digital Mars C++. 
	<li> Issues pertaining to porting 16-bit Windows 3.1 code to 
	Windows 95 or Windows NT. 
</ul>

<h3>General tips on porting to Digital Mars C++</h3>

This section provides tips on how to solve problems that might 
occur when porting code to Digital Mars C++ that was written with 
another compiler, or with a previous release of Digital Mars C++ or 
Zortech C++. For related information, see Chapter 22, "Switching to 
Digital Mars C++." 


<h4>Problem: iostreams library incompatible with -Ju </h4>

The Digital Mars C++ Version 7 iostreams library is incompatible with 
code compiled with the -Ju compiler option; syntax errors and link 
errors result. This is because, when you specify -Ju, the compiler 
treats char and unsigned charas the same type. This can cause 
distinct functions to appear to be the same, and can make mangled 
names different from the corresponding names in the iostreams 
library. 
<p>

Here are two recommended solutions: 

<ul>
	<li> Do not compile code that includes iostreams headers 
	with the -Ju compiler option. 

	<li> Replace all unsigned char and BYTE types with char, 
	and compile with the -J option. (This solution is more 
	compatible with Microsoft C++.) 
</ul>

<h4>Problem: Linker error "EXE header &gt; 64k" </h4>

This error results if your code exports too many names. 

If names in a DLL are not referenced by name at run-time using the 
Windows API function GetProcAddress(), you can specify the 
/BYORDINAL and /NONAMES linker options, which remove all 
names from the DLL header and use the corresponding ordinal 
numbers instead. 


<h4>Problem: GetProcAddress() fails </h4>

If you are exporting names by ordinal value (see above), no names 
are included in a DLL, and a call to GetProcAddress() with the 
name of the procedure will fail. This can also result in problems at 
link time and load time. 


Here are two recommended solutions: 

<ul>
	<li> Link with the linker option /XUPPER. 

	<li> Define an ordinal number for each name in the 
	definition (. DEF) file, and call GetProcAddress() 
	with the ordinal number instead of the procedure name. 
</ul>


<h4>Problem: Unsupported build steps </h4>

Your .MAK or .BAT files may contain build steps that the Digital Mars 
C++ IDDE does not support. For example, a makefile might call an 
SQL preprocessor that emits C code. The SQL code would need to 
be processed before the IDDE compiles the C files. 

You can solve this problem by adding a .MAK file to the Digital Mars 
C++ project. Put it before the compile step in the IDDE's Build 
Order list box. Then make a target "clean" (which should not be the 
first target); "clean" will be built when you rebuild the entire project. 
Note that the first target will be built in the makefile directory; 
"clean" will be built in the project directory. 


<h4>Problem: Linker error "DGROUP + Stack + Heap exceeds 64k-16" </h4>

The data segment of a 16-bit program can only be 64K bytes long. 
The combined data definitions of all your modules has exceeded this 
threshold. 

To solve this problem, check the "Set Data Threshold" check box on 
the Code Generation subpage of the Build page in the IDDE's 
Project Settings dialog box (or use the -GT1 compiler option). This 
directs the compiler to place data objects larger than the specified 
size in their own far data segments. Setting the size to 1 puts all data 
objects in individual data segments. 


<h4>Problem: Moving a project "loses" the libraries </h4>

In this case, the compiler cannot find libraries after you move an 
existing IDDE project to a new directory. 

When you add a library in the \dmc\lib directory to a project, do 
not specify a path. This prevents the IDDE from assigning the library 
a path that is relative to the project directory. 


<h4>Problem: Path problems in sc.ini </h4>

If you specify the include path for your project in sc.ini, non-Digital Mars 
tools that rely on the definition of the INCLUDE 
environment variable for path information cannot access the 
information. 
Use autoexec.bat, the Windows NT Registry, or the project include 
directory setting instead. 


<h4>Problem: Path problems in autoexec.bat </h4>

If you specify the include path for your project in autoexec. bat, 
you need to restart Windows in order to change it, and the 
information will not be used for Windows NT builds. 

Use sc.ini, the Windows NT Registry, or the project include 
directory setting instead. 


<h4>Problem: Path problems with project include directory setting </h4>

If you specify the include path for your project in the IDDE's "Project 
include directory" setting, non-Digital Mars tools cannot access the 
information, and it will be specific to that project only. 

Use autoexec.bat, the Windows NT Registry, or sc.ini instead. 


<h4>Problem: Path problems in NT Registry </h4>

If you specify the include path for your project in the Windows NT 
Registry, you won't be able to change it via a batch file, and it won't 
be available for Windows 3.1 builds. 

Use autoexec.bat, the project include directory setting, or 
sc.ini instead. 


<h4>Problem: 16-bit programs with virtual functions crash </h4>

In this case, programs that use classes that define virtual functions 
cause General Protection Faults. For example, an executable defines 
a class with virtual functions, and the virtual functions are called by 
DLLs. 

This happens because executables with virtual functions must have 
"smart callbacks" set; otherwise, the function will be invoked with 
the wrong value for DS. (In the IDDE, click the "Load DS from SS" 
button in the Windows Prolog/ Epilog subpage of the Build page of 
the Project Settings dialog box.) For more information, see Chapter 
17, "Win16 Programming Guidelines." 


<h4>Problem: You need generic .MAK files </h4>

To create generic makefiles that can be called from different projects, 
get the name of the calling project from the predefined identifier 
MASTERPROJ. 


<h4>Problem: You need to link with a DLL at link time only </h4>

To link an EXE or DLL with another DLL at link time only: 

<ul>
	<li> For the called DLL, set Export By Ordinal, Don't 
	ExportNames, and Generate Import Library in the Linker 
	subpage of the Build page of the Project Settings dialog 
	box. 

	<li> For the calling EXE or DLL, add the resulting .LIB file to 
	the project. 
</ul>


<h4>Problem: You need to link with a DLL at run-time only </h4>

To link an EXE or DLL with another DLL at run-time only: 

<ul>
	<li> For the called DLL, turn off Export By Ordinal, Don't 
	Export Names, and Generate Import Library in the Linker 
	subpage of the Build page of the Project Settings dialog 
	box. 

	<li> For the calling executable or DLL, call 
	MakeProcInstance() with the name of the function. 
</ul>


<h3>Tips on porting from Microsoft Visual C++</h3>

This section provides tips on how to solve problems that might 
occur when porting code to Digital Mars C++ from Microsoft Visual 
C++. For related information, see Chapter 23, "Converting from 
Microsoft." 


<h4>Problem: _ExportedStub missing </h4>

The Microsoft C++ libraries provides the entry point _ExportStub, 
which can be exported by user .DEF files. 

Remove _ExportStub from your .DEF files; it is specific to 
Microsoft's implementation of its internal routine _GetGROUP. This 
change is unlikely to introduce any problems. 


<h4>Problem: WIN32 and _X86_ not defined </h4>

32-bit versions of Microsoft C++ provide a .MAK file that defines 
-DWIN32= 1 and -D_ X86_= 1. Digital Mars C++ does not provide this 
file. 

Digital Mars C++ defines these macros in the header file SCDEFS.H, 
which is included whenever you include a Win32 API header file. If 
you are not using the Win32 API, you can explicitly include 
SCDEFS.H, or define WIN32 and _X86_ on the compiler command 
line or with the IDDE. 


<h4>Problem: overloaded functions produce errors </h4>

Microsoft C++ (and Borland C++) do not distinguish between 
overloading of int and unsigned short. Digital Mars C++ does, 
and generates an error for each ambiguous reference. For example: 

<pre>
	void f(unsigned short);
	void f(int); 
	void main ()
	{ 
	    short s;
	    f(s);
	} 
</pre>

In Digital Mars C++, s can be promoted to either int or unsigned 
short, whereas Microsoft C++ always calls f(int). 

Problems in user code can be due to one function being declared in 
two slightly different ways, so that it looks like two different 
functions to Digital Mars C++. For example: 

<pre>
	void f(WORD);	// Later on in different #include'd file 
	void f(int);	// Looks like different C++ function 
</pre>


<h4>Problem: _MT not automatically defined </h4>

32-bit Microsoft C++ sets _MT=1 if the /MT (multi-threaded) option 
is specified. If /MD (multi-threaded DLL) is specified, 32-bit Microsoft 
C++ sets _MT=1 and _DLL=1. Digital Mars C++ has no equivalent 
switches because its 32-bit run-time library is always multi-threaded. 

To solve this problem, define _MT and _DLL on the SC command 
line as necessary. 


<h3>Tips on Porting from Borland C++</h3>

This section provides tips on how to solve problems that might 
occur when porting code to Digital Mars C++ from Borland C++ 
Version 3. For related information, see Chapter 24, "Converting from 
Borland." 


<h4>Problem: _DEFS.H </h4>

Borland C++ provides a file BC\ INCLUDE\_ DEFS.H, which their 
STDIO.H library includes. This file contains a number of definitions 
used in Borland header files; these definitions might also appear in 
user code. 

Although Digital Mars C++ does not provide equivalent definitions, you 
can explicitly include Borland's _DEFS.H in your Digital Mars C++ 
compilation. This is unlikely to introduce any problems. 


<h4>Problem: const * to non-const * conversion </h4>

Borland C++ permits implicit conversions between const * types and 
non-const * types. Digital Mars C++ does not permit this. For example: 


<pre>
	const char *p;
	char *q; 
	q = p;	// causes "cannot implicitly convert"
		// error in SC++ 
</pre>


Add explicit casts as necessary to add or remove const-ness An easy 
way to eliminate const-ness problems is to add this code: 

<pre>
	#define const 
</pre>


<h4>Problem: signed * to unsigned * conversion </h4>

Borland C++ permits implicit conversions between signed * types 
and unsigned * types. Digital Mars C++ does not permit this. For 
example: 

<pre>
	unsigned int *p;
	int *q; 
	q = p;	// causes "cannot implicitly convert"
		// error in SC++ 
</pre>

Add explicit casts as necessary to add or remove signed-ness. 


<h4>Problem: int to pointer conversion causes errors </h4>

Borland C++ allows ints to be converted to pointers with only a 
warning. This is an error in Digital Mars C++. 

To fix this error, explicitly cast or convert ints to pointers as 
appropriate. 


<h4>Problem: overloaded functions produce errors </h4>

Borland C++ (and Microsoft C++) do not distinguish between 
overloading of int and unsigned short. Digital Mars C++ does, 
and it generates an error for each ambiguous reference. For 
example: 

<pre>
	void f(unsigned short);
	void f(int); 

	void main()
	{ short s; 
	  f(s);
	} 
</pre>


In Digital Mars C++, s can be promoted to either int or unsigned 
short, whereas Borland C++ always calls f(int). 
<p>

Problems in user code can be due to one function being declared in 
two slightly different ways, so that it looks like two different 
functions to Digital Mars C++. For example: 

<pre>
	void f(WORD);	// Later on in a different #include file... 
	void f(int);	// Looks like a different C++ function 
</pre>


<h4>Problem: const-ness of overridden functions </h4>

Borland C++ allows a function of a derived class to have different 
const-ness from the same function in the base class, in violation of 
ARM 10.2. For example: 


<pre>
	class A {virtual int f(void);};
	class B: public A { 
	    const int f(void);	// SC++ generates "&lt; name&gt; previously declared 
				// as something else" error
	}; 
</pre>


To solve this problem, rewrite your code to make the const-ness of 
functions in derived classes match that of their base class 
equivalents. 


<h4>Problem: Definition of max and min macros for C++ </h4>

The Borland C++ windows.h header file does not define the 
macros max and min for C++. The Digital Mars C++ version of 
windows.h defines these macros. 
<p>

Here are two recommended solutions: 

<ul>
	<li> To keep min and max from being defined, add this code 
	before including windows.h:

<pre>
	#define NOMINMAX. 
</pre>

	<li> Add NOMINMAX to your project's Defines list box in the 
	IDDE (choose Project -Settings, click the Build tab, and 
	choose Compiler). 
</ul>

<h4>Problem: Inclusion of windows.h in resource files </h4>

The Borland IDE implicitly includes windows.h in any .RC file it 
compiles. The Digital Mars IDDE does not. Therefore, you need to 
explicitly add the code #include <windows.h> to .RC files. 


<h4>Problem: Redefinition of default arguments </h4>

Borland C++ allows redefinition of default arguments (in violation of 
ARM 8.2.6). For example: 

<pre>
	int f(int i = 0);
	int f(int i = 0);	// SC++ gives error 
</pre>


Remove the second default definition. For example: 

<pre>
	int f (int i = 0);
	int f (int i); 
</pre>


<h4>Problem: Automatic enum conversions </h4>

Borland C++ provides an option to "treat enums as ints." Digital Mars 
C++ does not allow implicit conversions of ints to enums, or implicit 
conversion of enums to other enums in C++ compilations. For 
example: 


<pre>
	enum color (black, red, green, blue);
	enum color current_color = NULL;	// SC++ error 
</pre>


There are two recommended solutions: 

<ul>
	<li> Change the code to use equivalent values from the enum 
	in question. For example:

<pre>
	enum color (black, red, green, blue);
	enum color current_color = red; 
</pre>

	<li> Cast int values to the enum. For example: 

<pre>
	enum colorcurrent_color = (enum color) NULL; 
</pre>
</ul>


<h4>Problem: Undefined escape cequences </h4>

Borland C++ ignores undefined escape sequences in strings. For 
example, it interprets \U as U. Digital Mars C++ generates an error in 
this case. 
To avoid the error, remove unnecessary escape characters (\) from 
strings. 


<h4>Problem: Return types for constructors/destructors </h4>

Borland C++ allows a return type for constructors and destructors (in 
violation of ARM 12.1 and ARM 12.4). Digital Mars C++ does not allow 
this. For example: 


<pre>
	void A::A() {...}	// SC++ generates "illegal constructor 
				// declaration" error
</pre>


Remove the return type from the declaration. For example: 

<pre>
	A::A() {...} 
</pre>


<h4>Problem: Differentiating functions by addressing or calling conventions </h4>

Borland C++ differentiates between two functions with the same 
name in a class if they have different addressing or calling 
conventions. Digital Mars C++ does not. For example: 


<pre>
	class x
	{
	    void func(); 
	    void __far__ pascal func (); // SC++ generates "function is already 
					// defined" error
	}; 
</pre>


The problematic declaration is most likely a mistake; remove the 
additional declaration. 


<h4>Problem: No implicit function declarations for derived classes </h4>

Borland C++ allows functions to be defined for a derived class that 
were only declared for the base class, not the derived class. For 
example: 


<pre>
	class A
	{ public: 
	    virtual void f() = 0;
	}; 

	class B: public A {};

	void B::f()	// SC++ generates "<function> is 
			// not a member of <class>" error
	{...} 
</pre>

Put explicit declarations for all of a class's functions in 
the class declaration. For example: 


<pre>
	class B: public A
	{   
	  public:
	    void f(); 
	};
</pre>


<h4>Problem: findfirst() and findnext() </h4>

The Borland versions of the functions findfirst() and 
findnext() take different parameters from their Digital Mars 
counterparts. 

Rewrite your code to use the Digital Mars versions of findfirst() 
and findnext(), or use _dos_findfirst() and 
_dos_findnext(). For information see the Digital Mars C++ Run-
time Library Reference. 


<h4>Problem: _control87() parameters </h4>

Borland C defines various constants for use as parameters to the 
_control87() function (MCW_EM, EM_INVALID, EM_DENORMAL, 
and so on), whose names differ from their Digital Mars equivalents. 

You can form the equivalent Digital Mars C constants by adding an 
underscore (_) to the Borland version; for example: _MCW_EM or 
_EM_INVALID. 


<h4>Problem: __DLL__ macro defined for DLL compilations </h4>

Borland C defines the macro __DLL__ for DLL compilations; 
Digital Mars C does not. 

Here are two recommended solutions: 

<ul>
	<li> If you are using the SC command line compiler, add -D 
	__DLL__ to the command line for all DLL compilations. 

	<li> From the IDDE, add __DLL__ to your project's Defines 
	list box in the IDDE (choose Project-Settings, click the 
	Build tab, and choose Compiler). 
</ul>


<h4>Problem: undefined type dosdate_t </h4>

The type dosdate_t declared in Borland C's dos.h file is not 
defined in Digital Mars C. 
Change all instances of dosdate_t to _dosdate_t. 


<h4>Problem: no values.h file </h4>

Borland C provides a file values.h, which defines various 
implementation defined limits (for instance, MAXINT, which 
represents the largest int). Digital Mars C does not provide an 
equivalent file. 

You can use the ANSI standard file limits.h instead. To do this, 
you will need to change the names of most of the defined identifiers 
(MAXINT is called INT_MAX, for instance). 


<h4>Problem: Typos in long identifiers </h4>

Borland C uses the first 32 characters in identifiers; Digital Mars C uses 
the first 254. This can expose typing errors at the ends of long 
identifiers. For example: 

<pre>
	#define I_am_not_very_happy_monday_morning 1
	i = I_am_not_very_happy_monday_mornings; 
	// BC does not generate an error; SC does 
</pre>

Fix any typing errors as needed. 


<h4>Problem: _argc and _argv not declared </h4>

Borland C declares the variables _argc and _argv in dos.h. 
Digital Mars C++ does not. 

Add the following declarations as needed: 

<pre>
	extern int __cdecl _argc;
	extern char ** __cdecl _argv; 
</pre>


Note that these names are not part of the published Digital Mars C/C++ 
run-time library interface, and are subject to change. 


<h4>Problem: Invalid bitmap syntax </h4>

The resource compiler run from the Borland IDE accepts an alternate 
syntax for BITMAPs, where the actual bitmap is specified in the code 
rather than in a file. For example: 

<pre>
	Example BITMAP
	BEGIN 
	    '42 4D 5E 00 ... 
</pre>

Digital Mars's RCC and Microsoft's RC do not accept this syntax. Use 
Borland's Resource Workshop to convert the text to a .BMP file and 
change the code to: 

<pre>
	Example BITMAP <file>.BMP 
</pre>


<h4>Problem: Invalid pointer conversions </h4>

Borland C allows conversion of different pointer types with only a 
warning. Digital Mars C++ does not. For example: 


<pre>
	void f()
	{   int *p; 
	    char **q;
	    q = p;	// SC generates error "cannot implicitly convert" 
</pre>

Examine your code for correctness, and add explicit casts where 
appropriate. 


<h4>Problem: Names declared in different header files </h4>

Some names that are defined in both Digital Mars C++ and Borland 
C++ are declared in different header files. An example is the run-time 
library function coreleft(), which is declared in stdlib.h 
in Digital Mars C++ and alloc.h in Borland C++. 

To fix this problem, change the header files that your code includes 
as appropriate. 


<h4>Problem: Automatic definitions </h4>

Borland C allows an extern variable to be declared without ever 
being explicitly defined. In Digital Mars C++, this results in the error 
"symbol undefined:&lt; symbol&gt;" at link time. For example, where the 
following is a complete program: 


<pre>
	extern int a;
	void main() {a = 1;} 
</pre>


Add explicit definitions to your code as required. 


<h4>Problem: Names referenced in .ASM files </h4>

Borland C++ mangles only function names. Digital Mars C++ mangles 
both function and variable names. This can cause link errors on 
names referenced in .ASM files. For example: extrn _a: word 
produces a link error in SC++ because the correct name is ?a@@ 3HA. 
<p>

There are two recommended solutions: 

<ul>
	<li> Add extern "C" to declarations of names referenced 
	in .ASM files before they are defined. For example: 

<pre>
		extern "C" short a;
		short a; 
</pre>

	<li> Change the assembly language code to refer to the 
	Digital Mars C++ mangled names. For example: 

<pre>
		extrn ?a@@3HA: word 
</pre>
</ul>

<h4>Problem: Inconsistencies in declarations at link time </h4>

Borland C++ only mangles the names of variables slightly. For 
example, for function pointers it does not encode the parameters of 
the function; Digital Mars C++ does. This can expose inconsistencies 
in declarations at link time. 
<p>

Make declarations consistent where needed. 


<h4>Problem: Inconsistencies in _pascal declarations at link time </h4>

Borland C++ does not encode the _pascal calling convention 
modifier into mangled names (except by making the mangling all 
lowercase); Digital Mars C++ does. This can expose inconsistencies in 
declarations at link time for case-insensitive links. 
<p>

Make declarations consistent where needed. 


<h4>Problem: opendir, closedir, etc. not available </h4>

The Borland library functions opendir, closedir, readdir, and 
rewinddir functions are not available in Digital Mars C++. 
<p>

Rewrite your code to use _dos_findfirst, _dos_findnext, or 
findfirst/ findnext(). For information, see the Digital Mars C++ 
Run-time Library Reference. 


<h4>Problem: Linker cannot export names </h4>

If the Digital Mars linker cannot find names listed in the project .DEF 
file's EXPORT list, one of these issues is the cause: 


<ul>
	<li> Digital Mars C++ and Borland C++ mangle C++ names 
	differently (see the information on name mangling 
	above). If this is the problem, you need to disassemble 
	the object module(s) to see what the names should be in 
	Digital Mars C++. 

	<li> Borland C++ does not mangle variable names (see 
	"Problem: Inconsistencies in declarations at link time" 
	above). If this is the problem, add extern "C" to the 
	appropriate declarations as described above. 

	<li> The Borland linker does not complain about nonexistent 
	names. If this is the problem, delete the nonexistent 
	names. 
</ul>


<h4>Problem: Undefined Borland identifiers in .RC files </h4>

Some Borland predefined identifiers, like IDHELP, are undefined 
when you compile resources with Digital Mars's RCC. 
<p>

Borland's resource compiler automatically includes bwcc.h, so you 
need to explicitly include bwcc.h in the .RC file. 


<h4>Problem: BC program does not load after conversion to SC </h4>

If this is your problem, you might find that one or more DLLs do not 
load, or "undefined dynalink" errors occur. 
<p>

Make sure that all Digital Mars compiler options match their Borland 
equivalents. For example, exports can be uppercase, by ordinal, 
export all far, and so on. 


<h4>Problem: BC program does not run after conversion to SC </h4>

If a Borland program compiles but does not run, check that all 
Digital Mars compiler options match their Borland equivalents. For 
example, Borland's default struct alignment is on byte boundaries, 
Digital Mars's is on word boundaries. 


<h4>Problem: _new_handler is not declared </h4>

Borland C++ declares pvf _new_handler in the file new.h. 
Digital Mars C++ does not. 
<p>

Simply add the declaration _PNH _new_handler as needed. 


<h4>Problem: _new_handler behavior is different </h4>

Borland's _new_handler function takes no arguments, and exits 
on failure. Digital Mars's _new_handler takes one argument (the 
number of bytes to make available) and returns zero on failure. 
<p>

Simply recode calls to _new_handler as needed. 


<h4>Problem: "class huge" syntax not supported </h4>

Borland C++ allows the keyword huge after class in a class 
declaration. Digital Mars C++ does not. For example: 

<pre>
	class huge A; 
</pre>

Rewrite any class declarations that use the huge keyword. 


<h4>Problem: Non-Pascal names not found at DLL load time </h4>

Windows cannot find exported names in a DLL if they are lowercase. 
Borland's IMPLIB solves this problem by always exporting names in 
DLLs by ordinal. Digital Mars's linker does not automatically do this; 
therefore, some non _pascal names might not be found when a 
DLL is loaded. 
<p>

Link with these Digital Mars linker options: /XUPPER (Export, 
uppercase) and /BYORDINAL (Export by ordinal). 


<h4>Problem: Can't convert between unsigned char and char </h4>

The Borland C++ option -K makes unsigned char and char the 
same type. 
<p>

Try one of these two possible solutions: 

<ul>
	<li> Compile with the Digital Mars C++ compiler option -Ju, 
	which is similar to Borland's -K option. Note, however, 
	that -Ju is incompatible with Digital Mars's iostreams 
	library (as described under "Problem: iostreams library 
	incompatible with -Ju" above). Do not use -Ju to 
	compile code that includes iostreams headers. 

	<li> Search for and replace all unsigned char and BYTE types 
	with char, and compile with Digital Mars's -J compiler 
	option. (This solution is more compatible with Microsoft 
	C++.) 
</ul>


<h3>Tips on porting from previous Digital Mars releases</h3>

This section provides tips
on how to solve problems that might 
occur when porting code from previous releases of Digital Mars C++ or 
Zortech C++. For related information, see Chapter 22, "Switching to 
Digital Mars C++." 


<h4>Problem: asm() function does not compile </h4>

Zortech C++ allowed instructions to be assembled from integers 
using the asm() pseudo-function. For example: 

<pre>
	asm (0x8C, 0x96, 0xCC, 0xFE); 
</pre>

Digital Mars C++ does not provide this function. Therefore, you need 
to replace asm() calls with calls to __emit__. For more 
information, see. "Chapter 5, "Using Assembly Language Functions." 


<h4>Problem: ios class not declared in iomanip.h </h4>

Previous versions of the iostreams library declared the ios class in 
iomanip.h. The current version of iostreams does not. 
<p>

You need to explicitly include iostream.h. 


<h4>Problem: Zortech library names are different </h4>

Zortech C++ library names specified in makefiles are different from 
the corresponding Digital Mars C++ names (ZWL corresponds to SWL, 
for example). 
<p>

Change your makefiles to use the Digital Mars C++ library names. Note 
that, since the names of libraries are specified in object files, it may 
not be necessary to explicitly specify them in the makefile. 


<h4>Problem: Compiler control program has a different name </h4>

The Zortech C++ compiler control program was ZTC.EXE. The 
Digital Mars C++ equivalent is SC.EXE. 
<p>

Change makefiles, batch files, and so forth to run SC instead of ZTC. 


<h4>Problem: Missing #endifs generate errors </h4>

Zortech C++ allowed #endif directives at the end of files to be 
omitted; it interpreted End of File as any number of #endifs. 
Digital Mars C++ does not. 
<p>

Add #endif directives to the ends of files as appropriate. 


<h4>Problem: __pascal names mangled in C++ files </h4>

Zortech C++ did not perform C++ name mangling on __pascal 
names. In Digital Mars C++, the __pascal modifier changes the 
calling sequence, but does not affect name mangling. 
<p>

Add the modifier extern "C" to declarations that should not be 
mangled. For more information, see Chapter 4, "Mixing Languages." 


<h4>Problem: Jumps around variable initializations disallowed </h4>

Zortech C++ allowed jumps around variable initializations, in 
violation of ARM 6.4.2. Digital Mars C++ does not allow this. For 
example: 

<pre>
	switch (i)
	{
	    int v1 = 2; // error 
	  case 1:
	    int v2 = 3; 
	  case 2:
	    if (v2 == 7) // error 
		... 
</pre>

There are two recommended solutions for this problem: 

<ul>
	<li> Move the variable initialization out of the case statement. 

	<li> Add braces around the declaration to restrict the 
	variable's scope to be within the area that the flow of 
	control can jump around. 
</ul>


<h4>Problem: Differences in mangled names </h4>

Zortech C++ code might not link with Digital Mars C++ because .ASM 
files reference mangled names. The Digital Mars C++ name mangling 
scheme differs from Zortech C++ name mangling. 
<p>

Use the OBJ2ASM utility to obtain the new mangled names, and 
manually edit the assembly language files to use these names. For 
information on Digital Mars C++ name mangling, see Chapter 4, 
"Mixing Languages." For information on OBJ2ASM, see Chapter 14, 
"Using Digital Mars C++ Utilities." 


<h4>Problem: WEP in user code causes a link error </h4>

Digital Mars C++ Version 6 allowed users to specify a WEP function in a 
DLL. Digital Mars C++ Version 7 provides a WEP function in the library, 
which handles static destructors and other cleanup functions on exit 
from the DLL. Thus, WEP functions should not be used if these 
function are required. 
<p>

If a DLL requires special termination procedures, put them in a 
function called _WEP. Digital Mars's WEP automatically calls _WEP. An 
_WEP function is not required, however. 


<h4>Problem: Access to protected members not allowed </h4>

Zortech C++ allowed access to protected member functions, in 
violation of ARM page 253. (Base class members can only be 
accessed through a derived class.) For example, the following is an 
error in Digital Mars C++: 


<pre>
	class A {protected: int x };
	class B: public A
	{ 
	    void f() { x = 10; }
	    void f1() {A *p = new A; p-&gt; x = 10; }	// error 
	    friend void f2(A*);
	    friend void f3(B*); 
	};

	void f2(A* a) { a-&gt;x = 10; } // error
	void f3(B* b) { b-&gt;x = 10; } 
</pre>

To solve this problem, recode invalid constructs as necessary. 


<h4>Problem: Mismatches in C++ const functions not allowed </h4>

Zortech C++ allowed mismatches in function declarations involving 
const-ness. For example, the following constructs, which were valid 
in Zortech C++, are invalid in Digital Mars C++: 


<pre>
	class A
	{ public: 
	    int operator== (A&amp;);
	}; 

	class B
	{   A a; 
	    int operator==(B&amp; b) const
	    {
		return (a == b.a);	// error in DMC++ 7 
	    }
	}; 
</pre>

In the above example, since B::operator== is const, B::a is 
const, but there is no matching function in A. To fix the error, you 
need to add the required matching function. To fix the example 
code above: 

<pre>
	class A
	{ public: 
	    int operator==(A&amp;);
	    int operator==(A&amp;) const; 
	}; 
</pre>


<h3>Tips on porting Win16 Code to Win32</h3>

This section provides tips on how to solve problems that might 
occur when porting 16-bit Windows 3.1 code to a 32-bit Windows 
environment. See Chapter 16, "Win32 Programming Guidelines," for 
general information on porting 16-bit code to Win32. 


<h4>Problem: Files not found when porting to Windows NT </h4>

Symptoms of this problem include .MAK or .BAT files generating 
errors, or programs not finding files. 
<p>

Windows NT does not run the autoexec.bat file, so your PATH 
environment variable (and other environment variables) may not be 
set. You need to manually add these values to the Windows NT 
Registry. 


<h4>Problem: 32-bit SmartHeap does not work </h4>

In this case, SmartHeap symbols are not found when linking with 32-bit 
SmartHeap libraries (specifically SHDW3SMD.LIB). 
<p>

The version of SHDW3SMD.LIB shipped with SmartHeap is not 
usable. To create a usable one, perform this step to create a new 
library directly from the SmartHeap DLL: 


<pre>
	implib /system shdw3smd.lib sh22w3sd.dll 
</pre>


<h4>Problem: Windows 3.1 functions undefined at link time </h4>

Some Windows 3.1 routines, such as GetCurrentTask(), are 
obsolete for Win32. 
<p>

You need to reengineer these routines. For information, see 
Microsoft Win32 API Programmer's Reference (available as the 
online Help file ..\dm\help\vc20bks4.hlp in Digital Mars C++). 


<h4>Problem: ToolHelp functions undefined at link time </h4>

The Windows 3.1 ToolHelp library, which includes functions like 
ModuleFindHandle() and StackTraceNext(), is not 
available in Win32. 
<p>

You need to reengineer these routines. For information, see 
Microsoft Win32 API Programmer's Reference (available as the 
online Help file ..\dm\help\vc20bks4.hlp in Digital Mars C++). 


<h4>Problem: Exported names not found </h4>

If this is a problem, the linker indicates that it cannot export any of 
the names in the .DEF file's export list, although the export list 
worked for Windows 3.1. 
<p>

Win32 defines PASCAL, WINAPI, and related functions as 
__stdcall; in Windows 3.1 they were defined as __pascal. This 
means that all PASCAL/ WINAPI functions now begin with an 
underscore (_) and are case-sensitive. Add underscores and change 
case in the export list as needed. 


<h4>Problem: Names in .ASM files not found </h4>

If this is a problem, the linker indicates that it cannot fnd PASCAL 
names that are declared in .ASM files, although it could for 
Windows 3.1. 
<p>

Win32 defines PASCAL as __stdcall; in Windows 3.1 it was 
defined as __pascal. __stdcall functions begin with an 
underscore (_) and are case-sensitive. Add underscores and change 
case in the assembly language definitions of the affected functions. 


<h4>Problem: DOS functions undefined in NT compilations </h4>

An example would be int86x and its parameter, union REGS, 
being undefined in a Windows NT compilation. 
<p>

Some DOS routines may need to be re-engineered using their 
Windows NT equivalents. For information, see Microsoft Win32 API 
Programmer's Reference (available as the online Help file 
 ..\dm\help\vc20bks4.hlp in Digital Mars C++). 


<h4>Problem: "FIXUPP" errors in 32-bit links </h4>

In this case, the linker generates an error for every reference to an 
external name in the build. 
<p>

You may be using outdated linker options. The Digital Mars C++ IDDE 
uses: /DO/DE/NT/Entry:__DllMainCRTStartup. 


<h4>Problem: Assembler files don't link in Win32 </h4>

In this case, assembly language code with .286 or 16-bit segments 
may not link. 
<p>

Recode affected files to remove 16-bit specific features. Note also 
that the use of segment registers is different for Win32 compilations. 


<h4>Problem: 32-bit link errors </h4>

In this case, you might need to convert your .DEF file to 32-bit. The 
Digital Mars C++ IDDE uses EXETYPE NT, no STUB, CODE SHARED 
EXECUTE DATA WRITE, and HEAPSIZE 100000,4096. 


<h4>Problem: Undefined resource symbols in Win32 links </h4>

To solve this problem, compile 32-bit resources for 32-bit links with 
the command RCC -32. 


<br><br><br><br>

</td></table>






<div id="copyright">
Copyright &copy; 1999-2006 by Digital Mars, All Rights Reserved |
Page generated by <a href="http://www.digitalmars.com/d/ddoc.html">Ddoc</a>.
</div>

</body>
</html>

