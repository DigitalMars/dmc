
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>

<!--
	Copyright (c) 1999-2006 by Digital Mars
	All Rights Reserved
	Written by Walter Bright
	www.digitalmars.com
  -->

<head>
<META http-equiv="content-type" content="text/html; charset=utf-8">
<title>Digital Mars - Runtime Library - new.h
</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
<div id="heading">
<a href="http://www.digitalmars.com/" target="_top"><IMG SRC="dmlogo.gif" BORDER=0 WIDTH=270 HEIGHT=53 ALT="www.digitalmars.com"></a>

<a href="http://www.digitalmars.com/" title="www.digitalmars.com">Home</a>
| <a href="../advancedsearch.html" title="Search Digital Mars web site">Search</a>
| <a href="../ctg/ctg.html" title="Compiler & Tools Guide">CTG</a>
| <a href="../rtl/rtl.html" title="Runtime Library Reference">RTL</a>
| <a href="../ugr/ugr.html" title="IDDE Reference">IDDE</a>
| <a href="../stl/index.html" title="Standard Template Library">STL</a>
| <a href="http://www.digitalmars.com/download/freecompiler.html" title="download C & C++ compiler">C/C++ Compiler</a>
| <a href="http://www.digitalmars.com/d/" title="D Programming Language">D</a>

	<div id="lastupdate">Last update Fri Apr 28 16:28:15 2006
</div>
</div>

<!-- Generated by Ddoc from new.d -->



<table border=1 cellpadding=8 cellspacing=0 frame="void" summary="this table is for layout only">
<tr>
<td valign="top" class="toc" nowrap>
<small>
<center>
<form method="get" action="http://www.google.com/search">
<input id="q" name="q" size="10" value="RTL Search" onFocus='if(this.value == "RTL Search"){this.value="";}'>
<input type="hidden" id="domains" name="domains" value="www.digitalmars.com">
<input type="hidden" id="sitesearch" name="sitesearch" value="www.digitalmars.com/rtl">
<input type="hidden" id="sourceid" name="sourceid" value="google-search">
<input type="submit" id="submit" name="submit" value="Go">
</form>

    <a href="rtl.html"><b>Runtime Library<br>Reference</b></a><br><br>
</center>

    &#183; <a href="constants.html">Constants</a><br>
    &#183; <a href="datatypes.html">Data types</a><br>

<hr><b>Standard C</b><br>

    &#183; <a href="assert.html">assert.h</a><br>
    &#183; <a href="complex.html">complex.h</a><br>
    &#183; <a href="ctype.html" title="character classification">ctype.h</a><br>
    &#183; <a href="fenv.html">fenv.h</a><br>
    &#183; <a href="float.html">float.h</a><br>
    &#183; <a href="locale.html">locale.h</a><br>
    &#183; <a href="math.html" title="math and trig">math.h</a><br>
    &#183; <a href="setjmp.html">setjmp.h</a><br>
    &#183; <a href="signal.html">signal.h</a><br>
    &#183; <a href="stdarg.html">stdarg.h</a><br>
    &#183; <a href="stddef.html">stddef.h</a><br>
    &#183; <a href="stdio.html">stdio.h</a><br>
    &#183; <a href="stdlib.html">stdlib.h</a><br>
    &#183; <a href="string.html">string.h</a><br>
    &#183; <a href="time.html">time.h</a><br>
    <br>

<hr><b>Standard C++</b><br>
    &#183; <a href="iostream.html">IOstream</a><br>
    &#183; <a href="new.html">new</a><br>
    <br>

<hr><b>Win32</b><br>
    &#183; <a href="gc.html" title="Hans Boehm garbage collector">gc.h</a><br>
    <br>

<hr><b>DOS, DOS32, Win16</b><br>
    &#183; <a href="bios.html" title="interface to BIOS API">bios.h</a><br>
    &#183; <a href="cerror.html" title="critical errors">cerror.h</a><br>
    &#183; <a href="disp.html" title="direct access to video display">disp.h</a><br>
    &#183; <a href="dos.html" title="interface to DOS API">dos.h</a><br>
    &#183; <a href="dos2.html">dos.h part 2</a><br>
    &#183; <a href="emm.html" title="expanded memory">emm.h</a><br>
    &#183; <a href="handle.html" title="handle pointers">handle.h</a><br>
    &#183; <a href="int.html" title="interrupt functions">int.h</a><br>
    &#183; <a href="msmouse.html" title="DOS mouse functions">msmouse.h</a><br>
    &#183; <a href="sound.html" title="interface to PC speaker">sound.h</a><br>
    &#183; <a href="swap.html">swap.h</a><br>
    &#183; <a href="tsr.html" title="Terminate Stay Resident functions">tsr.h</a><br>
    &#183; <a href="winio.html" title="Andrew Schulman's winio library">winio.h</a><br>
    <br>

<hr><b>Other C</b><br>
    &#183; <a href="bitops.html" title="access to CPU bit instructions">bitops.h</a><br>
    &#183; <a href="conio.html" title="console I/O">conio.h</a><br>
    &#183; <a href="controlc.html" title="control C">controlc.h</a><br>
    &#183; <a href="direct.html" title="directories">direct.h</a><br>
    &#183; <a href="fltpnt.html">fltpnt.h</a><br>
    &#183; <a href="io.html" title="low level file I/O">io.h</a><br>
    &#183; <a href="page.html" title="suballocate blocks of memory">page.h</a><br>
    &#183; <a href="process.html">process.h</a><br>
    &#183; <a href="search.html">search.h</a><br>
    &#183; <a href="sys-stat.html">sys\stat.h</a><br>
    &#183; <a href="tabsize.html">tabsize.h</a><br>
    &#183; <a href="../ctg/trace.html" title="Trace Dynamic Profiling">trace.h</a><br>
    &#183; <a href="time.html">utime.h</a><br>
    &#183; <a href="unmangle.html">unmangle.h</a><br>
    &#183; <a href="util.html">util.h</a><br>
    <br>

<hr><b>Other C++</b><br>
    &#183; <a href="regexp.html" title="regular expressions">regexp.h</a><br>
    &#183; <a href="oldcomplex.html">class complex</a><br>
    <br>

</small>

<hr>

</td>
<td valign="top">

<h1>new.h</h1>

<ul>
	<li><a href="#_set_new_handler"><b>_set_new_handler</b></a>
</ul>

<hr><!-- =========================================== -->

<a name="_set_new_handler"><h2>_set_new_handler</h2></a>

<font size=3><b>
Header
</b><p>
new.h
<p>

<b>
Prototype
</b><p>
_PNH _set_new_handler(_PNH pNewHandler); 
<p>

<b>
Description
</b><p>
The _set_new_handler function defines a handler to be called 
when the new operator is unable to allocate a requested amount of 
memory from the default heap. The _set_fnew_handler function 
establishes a new handler for the far heap; _set_nnew_handler 
establishes a new handler for the near heap. <p>

The _set_new_handler function automatically maps to either the 
_set_fnew_handler or _set_nnew_handler, depending on 
the default data model. <p>

For all of the _set_new_handler functions, the pNewHandler 
argument is a pointer to the function that you write to be called 
when new fails. This argument is of type _PNH, which is a pointer to 
a function that returns type int and takes an argument of type 
size_t. Use size_t to specify the amount of space to allocate. <p>

The _set_new_handler functions provide a garbage collection 
scheme. The run-time system retries allocation each time your 
function returns a non-zero value and fails if your function returns 0. <p>

In a multi-threaded environment, handlers are maintained separately 
for each process and thread. Each new process does not have 
installed handlers. Each new thread receives a copy of its parent 
thread's new handlers. Therefore, each process and thread must 
manage its own free-store error handling. 
<p>

<b>
Synonym
</b><p>
Function:  set_new_handler
<p>

<b>
Return Value
</b><p>
Returns a pointer to the previous new handler function. There is no 
error return. 
<p>

<b>
Compatibility
</b><p>
DOS Windows 3.x Phar Lap DOSX Win32 
<p>

<b>
See Also
</b><p>
<a href="stdlib.html#calloc">calloc Functions</a><br>
<a href="stdlib.html#free">free Functions</a><br>
<a href="stdlib.html#malloc">malloc Functions</a><br>
<a href="stdlib.html#realloc">realloc Functions</a>
<p>

<b>
Example
</b><p><pre>
	/* 	Example of _set_new_handler */ 

	#include &lt;stdlib.h&gt;
	#include &lt;stdio.h&gt; 
	#include &lt;new.h&gt; 

	#define MEMSIZE 1024 
	#define ZONESIZE MEMSIZE * 4 

	/* This is the safety zone. If this is eaten 
	   into, then memory is low */ 
	char * zone = new char[ZONESIZE]; 
	char * forprintf = new char[128]; 

	/* This handler will free the safety zone when 
           there is an allocation error. It won't 
           bother if the alloction request is too 
           big for the zone. */ 
	int zone_handler (size_t alocsize) 
	{ 
	   if (alocsize &gt; ZONESIZE) 
	   { 
	       delete forprintf; 
               printf("\nThat's it, now you've used up 
                       all the memory.\n"); 
	       return 0; 
	   } 

      	   if (zone) 
	   { 
	      delete zone; 
	      zone = NULL; 
	      printf("\nWARNING: Memory is low, 
		      they have taken the zone!\n"); 
	      return 1; 
	   } 

	   delete forprintf; 
	   printf("\nThat's it, now you've used up 
		   all the memory.\n"); return 0; 
	} 

	void main () 
	{ 
	   char * waste; 
	   unsigned long int total_wasted = 0; 

	   _set_new_handler (zone_handler); 

	   printf(" Wasting memory...\n"); 
	   do 
	   { 
	      printf("\rWasting %u", total_wasted); 
	      waste = new char[MEMSIZE]; 
	      total_wasted += MEMSIZE; 
	   } while (waste); 
	} 
</pre>

<b>
Output
</b><p>
Wasting memory...<br>
Wasting 46080<br>
WARNING: Memory is low, they have taken the zone!<br>
Wasting 49152<br> 
That's it, now you've used up all the memory. 






<br><br><br><br>

</td></table>




<div id="copyright">
Copyright &copy; 1997-2006 by Digital Mars, All Rights Reserved |
Page generated by <a href="http://www.digitalmars.com/d/ddoc.html">Ddoc</a>.
</div>

</body>
</html>

